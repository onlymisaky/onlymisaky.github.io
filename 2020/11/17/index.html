<!DOCTYPE html><html lang="zh-Hans"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="聊聊vue中的依赖注入"><meta name="keywords" content="vue"><meta name="author" content="onlymisaky"><meta name="copyright" content="onlymisaky"><title>聊聊vue中的依赖注入 | Mikasa</title><link rel="shortcut icon" href="/melody-favicon.ico"><link rel="stylesheet" href="/css/index.css?version=1.9.1"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.9.1"><meta name="format-detection" content="telephone=no"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容:${query}"}},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  hexoVersion: '7.3.0'
} </script><meta name="generator" content="Hexo 7.3.0"><link rel="alternate" href="/atom.xml" title="Mikasa" type="application/atom+xml">
</head><body><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar" data-display="true"><div class="toggle-sidebar-info text-center"><span data-toggle="切换文章详情">切换站点概览</span><hr></div><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Vue-%E7%9A%84%E7%BB%84%E4%BB%B6%E9%80%9A%E4%BF%A1%E6%96%B9%E5%BC%8F"><span class="toc-number">1.</span> <span class="toc-text">Vue 的组件通信方式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B0%81%E8%A3%85%E7%BB%84%E4%BB%B6%E7%9A%84%E6%96%B9%E5%BC%8F%E4%B8%8E%E7%9B%AE%E7%9A%84"><span class="toc-number">2.</span> <span class="toc-text">封装组件的方式与目的</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%9A%E5%8A%A1%E7%BB%84%E4%BB%B6%E7%9A%84%E6%8B%86%E5%88%86"><span class="toc-number">3.</span> <span class="toc-text">业务组件的拆分</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#provide-inject"><span class="toc-number">4.</span> <span class="toc-text">provide &amp; inject</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Vue3-%E4%B8%AD%E7%9A%84%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5"><span class="toc-number">5.</span> <span class="toc-text">Vue3 中的依赖注入</span></a></li></ol></div></div><div class="author-info hide"><div class="author-info__avatar text-center"><img src="/data/img/avatar.png"></div><div class="author-info__name text-center">onlymisaky</div><div class="author-info__description text-center"></div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">文章</span><span class="pull-right">24</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">标签</span><span class="pull-right">20</span></a></div></div></div><div id="content-outer"><div class="no-bg" id="top-container"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">Mikasa</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus">   <a class="site-page" href="/">主页</a><a class="site-page" href="/archives">归档</a><a class="site-page" href="/tags">标签</a><a class="site-page" href="/slides">演讲</a></span><span class="pull-right"><a class="site-page social-icon search"><i class="fa fa-search"></i><span> 搜索</span></a></span></div><div id="post-info"><div id="post-title">聊聊vue中的依赖注入</div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2020-11-17</time></div></div></div><div class="layout" id="content-inner"><article id="post"><div class="article-container" id="post-content"><h2 id="Vue-的组件通信方式"><a href="#Vue-的组件通信方式" class="headerlink" title="Vue 的组件通信方式"></a>Vue 的组件通信方式</h2><p>开篇先俗套一下，在 Vue 中，组件间的通信有以下几种方式: </p>
<ul>
<li><p>prop<br>作用: 父组件向子组件传值，单向数据流</p>
</li>
<li><p>$emit $on<br>作用: 子组件发布事件，父组件订阅事件</p>
</li>
<li><p>vuex<br>作用: 集中数据管理，数据共享</p>
</li>
<li><p>Event Bus<br>作用: 作为全局事件池，发布订阅事件</p>
</li>
<li><p>ref<br>作用: 通过ref获取子组件的引用(实例)，不是响应式的</p>
</li>
<li><p>$attrs $listeners<br>作用: 获取父作用域中除了 props 中声明的属性( class 和 style 也不包含在内) 和 事件( .native 除外)</p>
</li>
<li><p>$parent $children<br>作用: 获取当前组件的父实例和所有子实例(非响应式)</p>
</li>
<li><p>$root<br>作用: 获取当前组件数的根实例，实际上和 vuex 有相似之处</p>
</li>
<li><p>provide inject<br>作用: 依赖注入，将当前组件的方法和数据注入的子组件中，可以跨层级，非响应式</p>
</li>
</ul>
<h2 id="封装组件的方式与目的"><a href="#封装组件的方式与目的" class="headerlink" title="封装组件的方式与目的"></a>封装组件的方式与目的</h2><p>进入正题，通常情况下在设计一个组件的时候，我们会习惯性的将组件中的部分状态设计成 props 。以一个简单的 button 组件为例: </p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">ButtonBase</span> = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;ButtonBase&#x27;</span>,</span><br><span class="line">  <span class="attr">props</span>: &#123;</span><br><span class="line">    <span class="attr">type</span>: &#123;</span><br><span class="line">      <span class="attr">type</span>: <span class="title class_">String</span>,</span><br><span class="line">      <span class="attr">defualt</span>: <span class="string">&#x27;default&#x27;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">size</span>: &#123;</span><br><span class="line">      <span class="attr">type</span>: <span class="title class_">String</span>,</span><br><span class="line">      <span class="attr">defualt</span>: <span class="string">&#x27;small&#x27;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">disabled</span>: &#123;</span><br><span class="line">      <span class="attr">type</span>: <span class="title class_">Boolean</span>,</span><br><span class="line">      <span class="attr">defualt</span>: <span class="literal">false</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">template</span>: <span class="string">&#x27;...&#x27;</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>常用的事件则会通过 <code>$emit</code> 派发事件，例如 <code>$emit(&#39;click&#39;, $event)</code> 。如果还有更多不重要的属性和事件时，或者所写的组件只是对另一个更底层的组件进行包装(高阶组件)，就可以直接使用 <code>v-bind=&quot;$attrs&quot;</code> 和 <code>v-on=&quot;$listeners&quot;</code> 来进行事件和数据的绑定。</p>
<p>以上的这种思路，可以 cover 大部分的场景，但当涉及到双向数据流或非父子组件传值的时候，大家的方式就开始奔放起来了，常见的方式大概是以下几种:</p>
<ul>
<li>ref</li>
<li>veux</li>
<li>Event Bus</li>
</ul>
<p>借助这些方式几乎所有的场景都可以解决了，那我们再进入具体的场景分析一下。</p>
<p>首先想一下为什么需要封装组件？</p>
<p><strong>为了复用</strong></p>
<p>我猜你已经抢答了，但事实上除了组件库和项目中的基础组件，我们所写的业务组件几乎都不会有复用的场景，那我们在写业务代码的时候，为什么还要封装呢？</p>
<p><strong>为了代码的可维护性和可读性</strong></p>
<p>机智的你又回答对了，确实如此，作为一个平淡无奇的打工人，在封装代码的时候，一开始都是从可复用的角度出发，最后发现根本没有太多可复用的场景，甚至只用到一次，那我们封装的作用剩下了一个: 可维护性。</p>
<h2 id="业务组件的拆分"><a href="#业务组件的拆分" class="headerlink" title="业务组件的拆分"></a>业务组件的拆分</h2><p>站在 <strong>可维护性</strong> 这个角度再去思考组件该如何封装，以下面的原型图和需求为例，你会如何拆分组件？</p>
<p><img src="/2020/11/17/%E5%A4%84%E6%96%B9%E5%8E%9F%E5%9E%8B%E5%9B%BE.png" alt="处方原型图"></p>
<ol>
<li>上半部分为表单，用于写处方</li>
<li>下半部分为表格，用于展示历史处方</li>
<li>写处方和获取历史处方都需要一个 patientId ，从路由中获取</li>
<li>处方提交完成之后，下方历史处方需要同步更新</li>
<li>可以将下方表格中的一条处方复制到上方表单中，方便快速开方</li>
</ol>
<p>先简单分析一下，上半部分的表单和下半部分的表格功能虽然有耦合，但还是相对独立的，可以拆分为三个组件</p>
<ul>
<li>Prescription.vue 根组件</li>
<li>PrescriptionAdd.vue 写处方</li>
<li>PrescriptionHistory.vue 历史处方</li>
</ul>
<p><code>根组件</code>用于接收路由参数，因为需求中提到写处方和历史处方有一些联动，所以它可能还会承担两个兄弟组件间的通信作用。</p>
<p><code>写处方组件</code>有一部分独立的功能，那就是提交处方表单。需要联动的功能则是提交完成后通知<code>历史处方组件</code>更新数据。</p>
<p><code>历史处方组件</code>的独立功能是拉取展示历史数据，需要联动的功能是将一行数据复制发送给<code>写处方组件</code>。</p>
<p>每个组件的独立功能都比较简单，具体代码不予赘述。我们直接探讨需要联动的部分如何去实现。</p>
<p>第一个要探讨的点是路由中的参数 patientId 如何传递。最简单暴力的方式就是随用随取了: <code>this.$route.params.patientId</code> 。但是很明显，作为一个稍微有一点点追求的人，都不会用这种方式，因为耦合度太高了，所以我们选择通过路由组件传参的方式将 patientId 以 prop 的方式传递给<code>根组件</code>。然后再继续通过 prop 的方式将其传递给<code>写处方</code>和<code>历史处方</code>组件。</p>
<p>我们再考虑的长远一些，随着业务的不断增长需求也不断变化，有可能<code>写处方</code>和<code>历史处方</code>两个组件也会变成类似<code>根组件</code>一样的容器组件，这样可能又会抽一些组件出去，又要继续将 patientId 向更深层的子组件传递。再极端一点，可能有时候我们为了传递一个 prop 中间隔了很多层组件，而这个 prop 在这些组件却不会被使用到。</p>
<p>那有没有其他方法呢？这里就要引出本文所介绍的 <code>provide</code>&#x2F;<code>inject</code>。两者配合可以跨层级传递数据和方法，ElementUI 的表单组件就大量运用了这个功能，但它有一个明显的缺陷， <code>provide</code> 和 <code>inject</code> 绑定不是响应式的，这是 Vue 故意这样设计的，当然如果传入的是一个可监听对象，那对象的属性还是响应式的。</p>
<p><img src="/2020/11/17/provide%E7%A4%BA%E6%84%8F%E5%9B%BE.png" alt="provide示意图"></p>
<p>所以，我们可以用 <code>provide</code>&#x2F;<code>inject</code> 代替 prop 传递数据。这时候你可能会问，通过 <code>provide</code>&#x2F;<code>inject</code> 传递数据，那组件的复用性不就大大降低了吗，因为在使用的时候，必须保证被注入数据的子组件在有同样 <code>provide</code> 的父组件中使用。确实如此，但其实这种担心全是多余的，因为这一原则只适用于业务组件，业务组件的封装主要目的是提升代码的可维护性，也很少有复用的场景，<strong>即使有也是一个完整的业务流程，既 <code>provide</code> 和 <code>inject</code> 一定会同时存在。</strong> 如果出现了特殊的场景，可能要考虑组件的粒度是否需要更细致一些。当然这种方式千万不要用在基础组件中，比如上文所提到 Button 。</p>
<p>这样一来，我们的三个组件代码类似下面这样:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;Prescription&#x27;</span>, <span class="comment">// 强烈建议书写Name，方便在devtool调试</span></span><br><span class="line">  <span class="attr">props</span>: &#123;</span><br><span class="line">    <span class="comment">// 通过路由组件传参，将路由参数以 prop 方式传递给路由组件</span></span><br><span class="line">    <span class="attr">patientId</span>: &#123;</span><br><span class="line">      <span class="attr">type</span>: [<span class="title class_">String</span>, <span class="title class_">Number</span>],</span><br><span class="line">      <span class="attr">required</span>: <span class="literal">true</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">provide</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="comment">// 通过 provide 将 patientId 注入到子孙后代组件中</span></span><br><span class="line">      <span class="attr">patientId</span>: <span class="variable language_">this</span>.<span class="property">patientId</span>,</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;PrescriptionHistory&#x27;</span>,</span><br><span class="line">  <span class="comment">// 通过 inject 从父组件获取注入的 patientId</span></span><br><span class="line">  <span class="attr">inject</span>: [<span class="string">&#x27;patientId&#x27;</span>],</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>第二个要解决的问题是，如何解决两个兄弟组件间的数据通信。既在写处方完成之后如何通知<code>历史处方组件</code>更新数据，和如何将历史处方的数据发送到<code>写处方组件中</code>。</p>
<p>有一些经验的开发者可能早就想到用 Event Bus 了。在完成对应的操作之后，将相关的数据通过 Event Bus <code>emit</code> 一个事件发送出去，然后在需要订阅的组件内订阅相关事件，简略的代码大概如下:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;PrescriptionAdd&#x27;</span>,</span><br><span class="line">  <span class="attr">methods</span>: &#123;</span><br><span class="line">    <span class="title function_">onSubmit</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="comment">/** some code */</span></span><br><span class="line">      <span class="comment">// 提交表单完成后，发布事件</span></span><br><span class="line">      bus.$emit(<span class="string">&#x27;prescription-add-success&#x27;</span>, <span class="variable language_">this</span>.<span class="property">prescriptionFormList</span>);</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 将历史数据转换为表单数据 */</span></span><br><span class="line">    <span class="title function_">history2From</span>(<span class="params">data</span>) &#123; &#125;,</span><br><span class="line"></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">mounted</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">/** 在生命周期中订阅和取消订阅事件 */</span></span><br><span class="line">    bus.$on(<span class="string">&#x27;copy-prescription&#x27;</span>, <span class="variable language_">this</span>.<span class="property">history2From</span>);</span><br><span class="line">    <span class="variable language_">this</span>.$once(<span class="string">&#x27;hook:beforeDestroy&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      bus.$off(<span class="string">&#x27;copy-prescription&#x27;</span>, <span class="variable language_">this</span>.<span class="property">history2From</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;PrescriptionHistory&#x27;</span>,</span><br><span class="line">  <span class="attr">methods</span>: &#123;</span><br><span class="line">    <span class="title function_">onCopy</span>(<span class="params">row</span>) &#123;</span><br><span class="line">      <span class="comment">// 将选中的数据发送出去</span></span><br><span class="line">      bus.$emit(<span class="string">&#x27;copy-prescription&#x27;</span>, row);</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取历史处方数据</span></span><br><span class="line"><span class="comment">     * 不要怕名字长，一定要做到表意清晰</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="title function_">getPrescriptionHistoryList</span>(<span class="params"></span>) &#123;&#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">mounted</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">/** 在生命周期中订阅和取消订阅事件 */</span></span><br><span class="line">    bus.$on(<span class="string">&#x27;prescription-add-success&#x27;</span>, <span class="variable language_">this</span>.<span class="property">getPrescriptionHistoryList</span>);</span><br><span class="line">    <span class="variable language_">this</span>.$once(<span class="string">&#x27;hook:beforeDestroy&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      bus.$off(<span class="string">&#x27;prescription-add-success&#x27;</span>, <span class="variable language_">this</span>.<span class="property">getPrescriptionHistoryList</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这种方式实现起来很简单，甚至不需要父组件的参与。但是这就造成了事件满天飞的后果，一堆的 emit(‘xxx’) 这样的魔法自字符串不是很好维护，如果将这些事件名单独维护在一个文件中，又会像 redux 那样罗里吧嗦的。本人是很讨厌这样的模式，甚至因为魔法字符串的问题，我已经在新的项目中放弃了 Vuex 。</p>
<p>如果不用 Event Bus 的方式，还可使用 ref + $emit 的形式，主要思路就是由他们相同的父组件去订阅各自派发出的事件:</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">PrescriptionAdd</span> <span class="attr">ref</span>=<span class="string">&quot;PrescriptionAdd&quot;</span> </span></span><br><span class="line"><span class="tag">  @<span class="attr">prescription-add-success</span>=<span class="string">&quot;onPrescriptionAddSuccess&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">PrescriptionHistory</span> <span class="attr">ref</span>=<span class="string">&quot;PrescriptionHistory&quot;</span> </span></span><br><span class="line"><span class="tag">  @<span class="attr">copy-prescription</span>=<span class="string">&quot;onCopyPrescription&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;Prescription&#x27;</span>,</span><br><span class="line">  <span class="attr">computed</span>: &#123;</span><br><span class="line">    <span class="title class_">PrescriptionAdd</span>: &#123;</span><br><span class="line">      <span class="attr">cache</span>: <span class="literal">false</span>,</span><br><span class="line">      <span class="title function_">get</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">$refs</span>.<span class="property">PrescriptionAdd</span>;</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title class_">PrescriptionHistory</span>: &#123;</span><br><span class="line">      <span class="attr">cache</span>: <span class="literal">false</span>,</span><br><span class="line">      <span class="title function_">get</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">$refs</span>.<span class="property">PrescriptionHistory</span>;</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">methods</span>: &#123;</span><br><span class="line">    <span class="title function_">onPrescriptionAddSuccess</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">PrescriptionHistory</span></span><br><span class="line">        .<span class="title function_">getPrescriptionHistoryList</span>();</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">onCopyPrescription</span>(<span class="params">row</span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">PrescriptionHistory</span></span><br><span class="line">        .<span class="title function_">history2From</span>(row);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这样可以从一定程度上减少事件满天飞情况，但是已经让父组件参与进来了。而且不论是哪一种，两个完整的功能都被分散到三个(或以上的)文件当中。那从站在可维护的角度来说，我们肯定希望相关功能的代码不要被拆的七零八散，写的到出都是。如果能写在一起，不仅对后续的维护者是一种便利，就连 code review 也变得轻松很多。</p>
<h2 id="provide-inject"><a href="#provide-inject" class="headerlink" title="provide &amp; inject"></a>provide &amp; inject</h2><p>如何将这个功能写在一起呢？这时候就可以用到 <code>provide</code>&#x2F;<code>inject</code> 了。在 Vue 中用 js 写依赖注入有连个很明明显的缺陷:</p>
<ol>
<li>非响应式</li>
<li>没有一点点的类型提示</li>
</ol>
<p>这时候我们可以借助 <a target="_blank" rel="noopener" href="https://github.com/kaorun343/vue-property-decorator">vue-property-decorator</a> 提供的一些装饰器，通过 ts 的方式来写 Vue ，社区中已经有很多很多关于 vue-property-decorator 的介绍了，这里不再便赘述了(<a href="https://onlymisaky.github.io/2020/08/17/">安利一下自己写的ppt</a>)。</p>
<p>这里主要使用 <code>ProvideReactive</code> 和 <code>InjectReactive</code> 这两个装饰器。 <code>ProvideReactive</code>&#x2F;<code>InjectReactive</code> 是 <code>provide</code>&#x2F;<code>inject</code> 的反射版本，直白的讲就是让注入的值由非响应变为响应式。</p>
<blockquote>
<p>额外补充: <br />ProvideReactive 是将所有被注入数据包装成名称为 <code>__reactiveInject__</code> 的对象传入子孙组件，子孙组件中 的 InjectReactive 再通过属性计算的方式将 <code>__reactiveInject__</code> 映射到当前组件中，从而实现数据的同步更新，原理还是利用 <strong>当然如果传入的是一个可监听对象，那对象的属性还是响应式的</strong> 。</p>
</blockquote>
<p>接下来，我们忘记前面所有的，甚至忘记组件封装，原型图长什么样。要做的就是将开处方、查看历史处方、复制处方这些一连串的功能在一个类中实现，业务场景中也可以拆分成多个类，再通过 Mixins 的方式聚合到一起，这样一来我们大概会得到这样一份代码: </p>
<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Component</span>, <span class="title class_">Prop</span>, <span class="title class_">Vue</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;vue-property-decorator&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span>(&#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;Prescription&#x27;</span>,</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">class</span> <span class="title class_">Prescription</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Vue</span> &#123;</span><br><span class="line">  <span class="meta">@ProvideReactive</span>()</span><br><span class="line">  <span class="meta">@Prop</span>(&#123; <span class="attr">type</span>: <span class="title class_">Number</span>, <span class="attr">required</span>: <span class="literal">true</span> &#125;)</span><br><span class="line">  <span class="keyword">readonly</span> patientId!: <span class="built_in">number</span>;</span><br><span class="line"></span><br><span class="line">  prescriptionFormList = [];</span><br><span class="line"></span><br><span class="line">  <span class="title function_">onDelFormItem</span>(<span class="params">index</span>) &#123; &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">onSubmit</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title function_">fetch</span>(<span class="string">&#x27;&#x27;</span>).<span class="title function_">then</span>(<span class="function">() =&gt;</span> <span class="variable language_">this</span>.<span class="title function_">getPrescriptionHistoryList</span>());</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  prescriptionHistoryList = [];</span><br><span class="line"></span><br><span class="line">  <span class="title function_">getPrescriptionHistoryList</span>(<span class="params"></span>) &#123; &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">onCopyPrescription</span>(<span class="params"><span class="attr">row</span>: <span class="built_in">any</span></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">history2From</span>(row);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">history2From</span>(<span class="params"><span class="attr">data</span>: <span class="built_in">any</span></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> item = &#123; <span class="comment">/** */</span> &#125;;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">prescriptionFormList</span>.<span class="title function_">push</span>(item);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>接下来我们再按照最初的思路去拆分并编写组件:</p>
<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span>(&#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;PrescriptionAdd&#x27;</span>,</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">class</span> <span class="title class_">Prescription</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Vue</span> &#123;</span><br><span class="line">  <span class="meta">@InjectReactive</span>()</span><br><span class="line">  <span class="keyword">readonly</span> patientId!: <span class="built_in">number</span>;</span><br><span class="line"></span><br><span class="line">  prescriptionFormList = [];</span><br><span class="line"></span><br><span class="line">  <span class="title function_">onDelFormItem</span>(<span class="params">index</span>) &#123; &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">onSubmit</span>(<span class="params"></span>) &#123; &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span>(&#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;PrescriptionHistory&#x27;</span>,</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">class</span> <span class="title class_">Prescription</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Vue</span> &#123;</span><br><span class="line">  <span class="meta">@InjectReactive</span>()</span><br><span class="line">  <span class="keyword">readonly</span> patientId!: <span class="built_in">number</span>;</span><br><span class="line"></span><br><span class="line">  prescriptionHistoryList = [];</span><br><span class="line"></span><br><span class="line">  <span class="title function_">getPrescriptionHistoryList</span>(<span class="params"></span>) &#123; &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">onCopyPrescription</span>(<span class="params"><span class="attr">row</span>: <span class="built_in">any</span></span>) &#123; &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>写到这里就会发现，父组件和子孙组件有很多相同的数据和方法，那就在父组件(根组件)中，为需要注入到子孙组件中的属性加上 <code>@ProvideReactive</code> 装饰器，在子孙组件中相对应的数据上加上 <code>@InjectReactive</code> 装饰器，同时删除细节只保留声明，需要注意的是，虽然通过 Reactive 注入的数据虽然是响应式的，但依旧是单向数据流，所以对子孙组件而言仍旧是只读的，所以需要像 prop 一样加上 <code>readonly</code> 修饰符；需要注入到子孙组件中的方法则加上 <code>@Provide</code> 装饰器，这也可以节省更多的内存开销，修改之后代码如下:</p>
<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span>(&#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;Prescription&#x27;</span>,</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">class</span> <span class="title class_">Prescription</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Vue</span> &#123;</span><br><span class="line">  <span class="meta">@ProvideReactive</span>()</span><br><span class="line">  <span class="meta">@Prop</span>(&#123; <span class="attr">type</span>: <span class="title class_">Number</span>, <span class="attr">required</span>: <span class="literal">true</span> &#125;)</span><br><span class="line">  <span class="keyword">readonly</span> patientId!: <span class="built_in">number</span>;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@ProvideReactive</span>()</span><br><span class="line">  prescriptionFormList = [];</span><br><span class="line"></span><br><span class="line">  <span class="title function_">onDelFormItem</span>(<span class="params">index</span>) &#123; &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">onSubmit</span>(<span class="params"></span>) &#123; &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@ProvideReactive</span>()</span><br><span class="line">  prescriptionHistoryList = [];</span><br><span class="line"></span><br><span class="line">  <span class="title function_">getPrescriptionHistoryList</span>(<span class="params"></span>) &#123; &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">onCopyPrescription</span>(<span class="params"><span class="attr">row</span>: <span class="built_in">any</span></span>) &#123; &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">history2From</span>(<span class="params">data</span>) &#123; &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span>(&#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;PrescriptionAdd&#x27;</span>,</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">class</span> <span class="title class_">PrescriptionAdd</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Vue</span> &#123;</span><br><span class="line">  <span class="meta">@InjectReactive</span>()</span><br><span class="line">  <span class="keyword">readonly</span> patientId!: <span class="built_in">number</span>;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@InjectReactive</span>()</span><br><span class="line">  <span class="keyword">readonly</span> prescriptionFormList!: <span class="built_in">any</span>[];</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Inject</span>()</span><br><span class="line">  <span class="keyword">readonly</span> onDelFormItem!: <span class="function">(<span class="params">index</span>) =&gt;</span> <span class="built_in">void</span>;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Inject</span>()</span><br><span class="line">  <span class="keyword">readonly</span> onSubmit!: <span class="function">() =&gt;</span> <span class="built_in">void</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span>(&#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;PrescriptionHistory&#x27;</span>,</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">class</span> <span class="title class_">PrescriptionHistory</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Vue</span> &#123;</span><br><span class="line">  <span class="meta">@InjectReactive</span>()</span><br><span class="line">  <span class="keyword">readonly</span> patientId!: <span class="built_in">number</span>;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@InjectReactive</span>()</span><br><span class="line">  <span class="keyword">readonly</span> prescriptionHistoryList!: <span class="built_in">any</span>[];</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Inject</span>()</span><br><span class="line">  <span class="keyword">readonly</span> getPrescriptionHistoryList!: <span class="function">() =&gt;</span> <span class="built_in">void</span>;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Inject</span>()</span><br><span class="line">  <span class="keyword">readonly</span> onCopyPrescription!: <span class="function">(<span class="params"><span class="attr">row</span>: <span class="built_in">any</span></span>) =&gt;</span> <span class="built_in">void</span>;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">mounted</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">getPrescriptionHistoryList</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这样我们就把主要的(连续的)逻辑全部塞进了 <code>Prescription</code> 组件当中。这样做的优势不言而喻， code review 简直太爽了，同样代码的可维护性也有一定的提升。</p>
<p>但缺点也很明显: </p>
<ol>
<li>有太多冗余的声明</li>
<li>部分子孙组件完全弱化成了一个壳子，主要作用也就是模板了</li>
<li>在某些场景下，注入的数据可能会被子孙组件修改，虽然我们可以在父组件中为子孙组件 <code>Provide</code> 修改数据的方法，但还是会显得极为繁琐，比如上文例子中的 <code>prescriptionFormList</code> ，我们需要修改 <code>给药途径</code>, <code>单次剂量</code>, <code>数量</code>, <code>备注</code>。虽然可以直接在子组件内修改(因为是引用类型，是可以直接修改的)，但是这毕竟违背了单向数据流的原则。而且对于浅层次的数据，直接在子孙组件中修改，也会在控制台中抛出错误。</li>
</ol>
<h2 id="Vue3-中的依赖注入"><a href="#Vue3-中的依赖注入" class="headerlink" title="Vue3 中的依赖注入"></a>Vue3 中的依赖注入</h2><p>虽有 Vue 中的依赖注入有这些缺点，官方文档中也不推荐使用，但不妨碍它成为一个组织业务代码的大杀器。而且随着 Vue3 的到来，上面的这些缺点也都统统解决了。</p>
<p>Vue3 的组合式 API 为我们提供了 <code>provide</code> 和 <code>inject</code> 这两个方法，它们的作用和 Vue2 的依赖注入相同。但是它们可以将响应式数据 <code>ref</code> 和 <code>reactive</code> 注入到子孙组件中，这意味着我们不需要再用 hack 的方式让注入的值变为响应式，也不用再考虑因单向数据流而带来的复杂更新操作了，再配合上自定义 hook ，也能省去很多繁琐的声明，如果非要确保通过 <code>provide</code> 传递的数据不会被 <code>inject</code> 的组件更改，则可以使用 <code>readonly</code> 方法。</p>
<p>同样是开处方的需求为例，我们用 Composition Api 的方式来实现一下:</p>
<ol>
<li>首先写一个比较长的 hook ，将所需的业务代码代码组织起来</li>
</ol>
<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">PrescriptionContext</span> &#123;</span><br><span class="line">  <span class="attr">prescriptionFormList</span>: <span class="title class_">Ref</span>&lt;<span class="built_in">any</span>[]&gt;;</span><br><span class="line">  <span class="title function_">onDelFormItem</span>(<span class="attr">index</span>: <span class="built_in">number</span>): <span class="built_in">void</span>;</span><br><span class="line">  <span class="title function_">onSubmit</span>(): <span class="built_in">void</span>;</span><br><span class="line"></span><br><span class="line">  <span class="attr">prescriptionHistoryList</span>: <span class="title class_">Ref</span>&lt;<span class="built_in">any</span>[]&gt;;</span><br><span class="line">  <span class="title function_">getPrescriptionHistoryList</span>(): <span class="built_in">void</span>;</span><br><span class="line">  <span class="title function_">onCopyPrescription</span>(<span class="attr">row</span>: <span class="built_in">any</span>): <span class="built_in">void</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 通过 InjectionKey 接口提供类型支持</span></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">PrescriptionToken</span>: <span class="title class_">InjectionKey</span>&lt;<span class="title class_">PrescriptionContext</span>&gt; = <span class="title class_">Symbol</span>(<span class="string">&#x27;PrescriptionToken&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">usePrescriptionProvider</span>(<span class="params">patientId</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> prescriptionFormList = <span class="title function_">ref</span>([]);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">onDelFormItem</span>(<span class="params"><span class="attr">index</span>: <span class="built_in">number</span></span>) &#123; &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">onSubmit</span>(<span class="params"></span>) &#123; &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> prescriptionHistoryList = <span class="title function_">ref</span>([]);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">getPrescriptionHistoryList</span>(<span class="params"></span>) &#123; &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">onCopyPrescription</span>(<span class="params"><span class="attr">row</span>: <span class="built_in">any</span></span>) &#123; &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">provide</span>(<span class="title class_">PrescriptionToken</span>, &#123;</span><br><span class="line">    prescriptionFormList,</span><br><span class="line">    onDelFormItem,</span><br><span class="line">    onSubmit,</span><br><span class="line">    prescriptionHistoryList,</span><br><span class="line">    getPrescriptionHistoryList,</span><br><span class="line">    onCopyPrescription,</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">onMounted</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">getPrescriptionHistoryList</span>();</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">usePrescriptionInject</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> prescriptionContext = inject&lt;<span class="title class_">PrescriptionContext</span>&gt;(<span class="title class_">PrescriptionToken</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (!prescriptionContext) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;usePrescriptionInject must be used after usePrescriptionProvider&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> prescriptionContext;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>剩下的工作就是愉快的复制粘贴模板了</li>
</ol>
<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="title function_">defineComponent</span>(&#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;Prescription&#x27;</span>,</span><br><span class="line">  <span class="attr">props</span>: &#123;</span><br><span class="line">    <span class="attr">patientId</span>: &#123;</span><br><span class="line">      <span class="attr">type</span>: <span class="title class_">Number</span>,</span><br><span class="line">      <span class="attr">required</span>: <span class="literal">true</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">setup</span>(<span class="params">props</span>) &#123;</span><br><span class="line">    <span class="title function_">usePrescriptionProvider</span>(props.<span class="property">patientId</span>);</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="title function_">defineComponent</span>(&#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;PrescriptionAdd&#x27;</span>,</span><br><span class="line">  <span class="title function_">setup</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123;</span><br><span class="line">      prescriptionFormList,</span><br><span class="line">      onDelFormItem,</span><br><span class="line">      onSubmit,</span><br><span class="line">    &#125; = <span class="title function_">usePrescriptionInject</span>();</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      prescriptionFormList,</span><br><span class="line">      onDelFormItem,</span><br><span class="line">      onSubmit,</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="title function_">defineComponent</span>(&#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;PrescriptionHistory&#x27;</span>,</span><br><span class="line">  <span class="title function_">setup</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123;</span><br><span class="line">      prescriptionHistoryList,</span><br><span class="line">      getPrescriptionHistoryList,</span><br><span class="line">      onCopyPrescription,</span><br><span class="line">    &#125; = <span class="title function_">usePrescriptionInject</span>();</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      prescriptionHistoryList,</span><br><span class="line">      getPrescriptionHistoryList,</span><br><span class="line">      onCopyPrescription,</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>这样一番改造之后，有没有发现单文件组件完全沦为了 <code>模板</code> 和 <code>setup</code> 的容器，我们的将所有业务逻辑全都迁移到了自定义 hook 当中，是不是更加清爽了许多，而且还可以利用所学的设计模式，继续魔改我们的 <code>usePrescriptionProvider</code> 。什么？你觉得烦？但这不就是架构师该做的事情么(让别人参照自己的规范编写代码，同时提供周边的工具链)。 webpack 配置工程师是不会的。</p>
</div></article><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/vue/">vue</a></div><div class="post-qr-code"><div class="post-qr-code-item"><img class="post-qr-code__img" src="/data/img/wechat.jpeg"><div class="post-qr-code__desc">请我喝杯咖啡</div></div><div class="post-qr-code-item"><img class="post-qr-code__img" src="/data/img/alipay.jpg"><div class="post-qr-code__desc">请我喝杯咖啡</div></div></div><div class="social-share pull-right"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/css/share.min.css"><script src="https://cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/js/social-share.min.js"></script><nav id="pagination"><div class="prev-post pull-left"><a href="/2021/02/11/"><i class="fa fa-chevron-left">  </i><span>扬帆起航</span></a></div><div class="next-post pull-right"><a href="/2020/08/28/"><span>Event Loop</span><i class="fa fa-chevron-right"></i></a></div></nav><div id="vcomment"></div><script src="https://cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js"></script><script>var notify = 'true' == 'true';
var verify = 'false' == 'true';
var record_ip = '' == 'true';
var GUEST_INFO = ['nick','mail','link'];
var guest_info = 'nick,mail'.split(',').filter(function(item){
  return GUEST_INFO.indexOf(item) > -1
});
guest_info = guest_info.length == 0 ? GUEST_INFO :guest_info;
window.valine = new Valine({
  el:'#vcomment',
  notify:notify,
  verify:verify,
  recordIP:record_ip,
  appId:'YrE19blOm57GQPNTt88rSVH1-gzGzoHsz',
  appKey:'oRNhpwKhbCysF0mGtcnONIQA',
  placeholder:'快来评论吧',
  avatar:'mm',
  guest_info:guest_info,
  pageSize:'10',
  lang: 'zh-cn'
})</script></div></div><footer><div class="layout" id="footer"><div class="copyright">&copy;2018 - 2024 By onlymisaky</div><div class="framework-info"><span>驱动 - </span><a target="_blank" rel="noopener" href="http://hexo.io"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 - </span><a target="_blank" rel="noopener" href="https://github.com/Molunerfinn/hexo-theme-melody"><span>Melody</span></a></div><div class="footer_custom_text">Hey! You Find Me!</div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fa fa-file-o"></i><span id="busuanzi_value_page_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.9.1"></script><script src="/js/fancybox.js?version=1.9.1"></script><script src="/js/sidebar.js?version=1.9.1"></script><script src="/js/copy.js?version=1.9.1"></script><script src="/js/fireworks.js?version=1.9.1"></script><script src="/js/transition.js?version=1.9.1"></script><script src="/js/scroll.js?version=1.9.1"></script><script src="/js/head.js?version=1.9.1"></script><script src="/js/search/local-search.js"></script><script>if(/Android|webOS|iPhone|iPod|iPad|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
  $('#top-container').addClass('is-mobile')
}</script><div class="search-dialog" id="local-search"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章"></div></div></div><hr><div id="local-search-results"><div id="local-hits"></div><div id="local-stats"><div class="local-search-stats__hr" id="hr"><span>由</span> <a target="_blank" rel="noopener" href="https://github.com/wzpan/hexo-generator-search" style="color:#49B1F5;">hexo-generator-search</a>
 <span>提供支持</span></div></div></div><span class="search-close-button"><i class="fa fa-times"></i></span></div><div class="search-mask"></div></body></html>